<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwingCity Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>

<div class="admin-dashboard">
    <div class="dashboard-header">
        <h1>ğŸ¯ SwingCity Admin Dashboard</h1>
        <div class="admin-nav">
            <a href="/admin/teams" class="btn btn-primary">ğŸ‘¥ Team Creator</a>
            <a href="/admin/osc" class="btn btn-warning">ğŸµ OSC Router</a>
            <a href="/leaderboard" class="btn btn-info">ğŸ† Leaderboard</a>
            <a href="/podium" class="btn btn-success">ğŸ… Podium</a>
        </div>
        <div class="system-status">
            <span class="status-indicator" id="system-status">ğŸŸ¢ System Online</span>
            <span class="timestamp">Last Update: <span id="last-update"><%= new Date().toLocaleTimeString() %></span></span>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>Firebase Status</h3>
            <div class="stat-number" id="firebase-status">ğŸ”¥ Checking...</div>
        </div>
        <div class="stat-card">
            <h3>Active Games</h3>
            <div class="stat-number" id="active-games"><%= gameState.activeGames.length %></div>
        </div>
        <div class="stat-card">
            <h3>Connected Tablets</h3>
            <div class="stat-number" id="connected-tablets">0</div>
        </div>
        <div class="stat-card">
            <h3>System Uptime</h3>
            <div class="stat-number" id="uptime">Loading...</div>
        </div>
    </div>

    <!-- Holes Overview -->
    <div class="holes-grid">
        <h2>ğŸ•³ï¸ Holes Status</h2>
        <div class="holes-container">
            <% Object.entries(holes).forEach(([holeId, hole], index) => { %>
                <div class="hole-card" data-hole-id="<%= holeId %>">
                    <div class="hole-header">
                        <h3><%= hole.displayName %></h3>
                        <span class="hole-status idle" id="status-<%= holeId %>">Idle</span>
                    </div>
                    <div class="hole-info">
                        <p><%= hole.description %></p>
                        <div class="hole-actions">
                            <a href="/tablet/<%= index + 1 %>" class="btn btn-primary btn-sm" target="_blank">
                                ğŸ“± Open Tablet
                            </a>
                            <button onclick="resetHole('<%= holeId %>')" class="btn btn-warning btn-sm">
                                ğŸ”„ Reset
                            </button>
                        </div>
                    </div>
                    <div class="hole-details" id="details-<%= holeId %>">
                        <small>No active game</small>
                    </div>
                </div>
            <% }); %>
        </div>
    </div>

    <!-- Leaderboard -->
    <div class="leaderboard-section">
        <h2>ğŸ† Current Leaderboard</h2>
        <div class="leaderboard-controls mb-3">
            <button onclick="refreshLeaderboard()" class="btn btn-primary">ğŸ”„ Refresh</button>
            <a href="/leaderboard" class="btn btn-info" target="_blank">ğŸ“º Open Leaderboard Display</a>
        </div>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Team</th>
                        <th>RFID</th>
                        <th>Total Score</th>
                        <th>Holes Completed</th>
                        <th>Players</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-table">
                    <tr><td colspan="6" class="text-center">Loading leaderboard...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Active Games -->
    <div class="active-games-section">
        <h2>ğŸ® Active Games</h2>
        <div class="games-table">
            <table class="table">
                <thead>
                    <tr>
                        <th>RFID</th>
                        <th>Hole</th>
                        <th>Current Player</th>
                        <th>Throw</th>
                        <th>Started</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="active-games-table">
                    <% if (gameState.activeGames.length === 0) { %>
                        <tr><td colspan="6" class="text-center">No active games</td></tr>
                    <% } else { %>
                        <% gameState.activeGames.forEach(([rfid, game]) => { %>
                            <tr data-rfid="<%= rfid %>">
                                <td><%= rfid %></td>
                                <td><%= game.holeId %></td>
                                <td><%= game.players[game.currentPlayerIndex]?.name || 'Unknown' %></td>
                                <td><%= game.currentThrow + 1 %>/3</td>
                                <td><%= new Date(game.startTime).toLocaleTimeString() %></td>
                                <td>
                                    <button onclick="endGame('<%= rfid %>')" class="btn btn-danger btn-sm">
                                        ğŸ›‘ End Game
                                    </button>
                                </td>
                            </tr>
                        <% }); %>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

    <!-- System Controls -->
    <div class="system-controls">
        <h2>âš™ï¸ System Controls</h2>
        <div class="controls-grid">
            <button onclick="refreshDashboard()" class="btn btn-primary">
                ğŸ”„ Refresh Dashboard
            </button>
            <button onclick="resetAllHoles()" class="btn btn-warning">
                ğŸ”„ Reset All Holes
            </button>
            <button onclick="exportLogs()" class="btn btn-info">
                ğŸ“„ Export Logs
            </button>
            <button onclick="systemRestart()" class="btn btn-danger">
                ğŸ”„ Restart System
            </button>
        </div>
    </div>

    <!-- API Testing -->
    <div class="api-testing">
        <h2>ğŸ§ª API Testing</h2>
        <div class="test-controls">
            <div class="test-group">
                <h4>Simulate RFID Tap</h4>
                <input type="text" id="test-rfid" placeholder="RFID Number" value="1234567890">
                <select id="test-hole">
                    <% Object.keys(holes).forEach(holeId => { %>
                        <option value="<%= holeId %>"><%= holes[holeId].displayName %></option>
                    <% }); %>
                </select>
                <button onclick="simulateRFIDTap()" class="btn btn-success">Tap Card</button>
            </div>
            <div class="test-group">
                <h4>Simulate Score</h4>
                <input type="number" id="test-score" placeholder="Score" value="50">
                <input type="number" id="test-throw" placeholder="Throw #" value="1" min="1" max="3">
                <button onclick="simulateScore()" class="btn btn-success">Add Score</button>
            </div>
        </div>
    </div>

    <!-- Real-time Log -->
    <div class="realtime-log">
        <h2>ğŸ“ Real-time System Log</h2>
        <div class="log-container" id="log-container">
            <div class="log-entry">
                <span class="timestamp"><%= new Date().toLocaleTimeString() %></span>
                <span class="level info">INFO</span>
                <span class="message">Admin dashboard loaded</span>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/admin.js"></script>

</body>
</html>
