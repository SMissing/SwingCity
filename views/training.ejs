<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training - SwingCity</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/pin-lock.css">
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@2.3.0/dist/iconify-icon.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --accent-green: #00ff88;
            --accent-blue: #00d4ff;
            --accent-purple: #a855f7;
            --accent-pink: #ec4899;
            --accent-orange: #f97316;
            --accent-cyan: #06b6d4;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --border-subtle: rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: 'Space Grotesk', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Subtle animated background */
        .bg-pattern {
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(236, 72, 153, 0.04) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(6, 182, 212, 0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(168, 85, 247, 0.02) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .back-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            border-color: var(--accent-pink);
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        /* Role Tabs */
        .role-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: var(--bg-card);
            padding: 0.5rem;
            border-radius: 16px;
            border: 1px solid var(--border-subtle);
        }

        .role-tab {
            flex: 1;
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .role-tab:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .role-tab.active {
            background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
            color: white;
            box-shadow: 0 4px 20px rgba(236, 72, 153, 0.3);
        }

        .role-tab iconify-icon {
            font-size: 1.25rem;
        }

        /* Progress Bar */
        .progress-section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .progress-title {
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-title iconify-icon {
            color: var(--accent-green);
        }

        .progress-stats {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-note {
            margin-top: 0.75rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.7;
        }

        .progress-note iconify-icon {
            font-size: 1rem;
            color: var(--accent-blue);
        }

        /* Training Content Panels */
        .training-content {
            display: none;
        }

        .training-content.active {
            display: block;
        }

        /* Module Cards */
        .module-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .module-card:hover {
            border-color: rgba(255, 255, 255, 0.15);
        }

        .module-header {
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .module-header:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .module-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .module-icon.video {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .module-icon.text {
            background: linear-gradient(135deg, var(--accent-blue), #0891b2);
            color: white;
        }

        .module-icon.guide {
            background: linear-gradient(135deg, var(--accent-purple), #7c3aed);
            color: white;
        }

        .module-info {
            flex: 1;
        }

        .module-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .module-meta {
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .module-meta span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .module-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-badge {
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-badge.completed {
            background: rgba(0, 255, 136, 0.15);
            color: var(--accent-green);
        }

        .status-badge.in-progress {
            background: rgba(251, 191, 36, 0.15);
            color: #fbbf24;
        }

        .status-badge.not-started {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-secondary);
        }

        .expand-icon {
            color: var(--text-secondary);
            transition: transform 0.3s ease;
        }

        .module-card.expanded .expand-icon {
            transform: rotate(180deg);
        }

        /* Module Content */
        .module-content {
            display: none;
            padding: 0 1.5rem 1.5rem;
            border-top: 1px solid var(--border-subtle);
        }

        .module-card.expanded .module-content {
            display: block;
        }

        .content-body {
            padding-top: 1.5rem;
        }

        .content-text {
            color: var(--text-secondary);
            line-height: 1.7;
            font-size: 0.95rem;
        }

        .content-text p {
            margin-bottom: 1rem;
        }

        .content-text ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .content-text li {
            margin-bottom: 0.5rem;
        }

        .content-text strong {
            color: var(--text-primary);
        }

        /* Video Container */
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            margin: 1rem 0;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
        }

        .video-container iframe,
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1a1a2e, #0f0f1a);
            color: var(--text-secondary);
        }

        .video-placeholder iconify-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Mark Complete Button */
        .complete-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 1rem;
            margin-top: 1rem;
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            color: var(--accent-green);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .complete-btn:hover {
            background: rgba(0, 255, 136, 0.15);
            border-color: var(--accent-green);
        }

        .complete-btn.completed {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: #0a0a0f;
        }

        .complete-btn iconify-icon {
            font-size: 1.25rem;
        }

        /* Quiz Modal */
        .quiz-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .quiz-overlay.active {
            display: flex;
        }

        .quiz-modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 24px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .quiz-header {
            padding: 2rem 2rem 1.5rem;
            border-bottom: 1px solid var(--border-subtle);
        }

        .quiz-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .quiz-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .quiz-progress {
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quiz-progress-bar {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .quiz-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan));
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .quiz-progress-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            min-width: 60px;
            text-align: right;
        }

        .quiz-content {
            padding: 2rem;
        }

        .quiz-question {
            display: none;
        }

        .quiz-question.active {
            display: block;
        }

        .question-number {
            font-size: 0.85rem;
            color: var(--accent-blue);
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .quiz-option {
            padding: 1rem 1.25rem;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            text-align: left;
            color: var(--text-primary);
        }

        .quiz-option:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .quiz-option.selected {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--accent-green);
        }

        .quiz-option.correct {
            background: rgba(0, 255, 136, 0.15);
            border-color: var(--accent-green);
        }

        .quiz-option.incorrect {
            background: rgba(239, 68, 68, 0.15);
            border-color: #ef4444;
        }

        .quiz-actions {
            padding: 1.5rem 2rem 2rem;
            border-top: 1px solid var(--border-subtle);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .quiz-btn {
            padding: 0.875rem 1.75rem;
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quiz-btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            border: 1px solid var(--border-subtle);
        }

        .quiz-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
        }

        .quiz-btn-primary {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            color: #0a0a0f;
        }

        .quiz-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.3);
        }

        .quiz-btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .quiz-result {
            text-align: center;
            padding: 2rem;
        }

        .quiz-result-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .quiz-result-icon.success {
            color: var(--accent-green);
        }

        .quiz-result-icon.failed {
            color: #ef4444;
        }

        .quiz-result-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .quiz-result-score {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
        }

        .empty-state iconify-icon {
            font-size: 4rem;
            color: var(--text-secondary);
            opacity: 0.5;
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: var(--text-secondary);
        }

        /* Footer */
        .footer {
            margin-top: auto;
            padding-top: 2rem;
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
            opacity: 0.6;
        }

        /* Animations */
        .module-card {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease forwards;
        }

        .module-card:nth-child(1) { animation-delay: 0.1s; }
        .module-card:nth-child(2) { animation-delay: 0.15s; }
        .module-card:nth-child(3) { animation-delay: 0.2s; }
        .module-card:nth-child(4) { animation-delay: 0.25s; }
        .module-card:nth-child(5) { animation-delay: 0.3s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem 1rem;
            }

            .role-tabs {
                flex-direction: column;
            }

            .role-tab {
                padding: 0.85rem 1rem;
            }

            .page-title {
                font-size: 1.4rem;
            }

            .module-header {
                padding: 1.25rem;
            }

            .module-icon {
                width: 44px;
                height: 44px;
                font-size: 1.25rem;
            }

            .module-title {
                font-size: 1rem;
            }

            .module-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }
        }
    </style>
</head>
<body>
    <%- include('partials/pin-lock') %>

    <!-- Quiz Modal -->
    <div class="quiz-overlay" id="quizOverlay">
        <div class="quiz-modal">
            <div class="quiz-header">
                <h2 class="quiz-title">Knowledge Check</h2>
                <p class="quiz-subtitle">Answer these questions to confirm you understood the content</p>
                <div class="quiz-progress">
                    <div class="quiz-progress-bar">
                        <div class="quiz-progress-fill" id="quizProgressFill" style="width: 0%"></div>
                    </div>
                    <span class="quiz-progress-text" id="quizProgressText">1 of 3</span>
                </div>
            </div>
            <div class="quiz-content" id="quizContent">
                <!-- Questions will be inserted here -->
            </div>
            <div class="quiz-actions">
                <button class="quiz-btn quiz-btn-secondary" id="quizCancelBtn">
                    <iconify-icon icon="ph:x-bold"></iconify-icon>
                    Cancel
                </button>
                <button class="quiz-btn quiz-btn-primary" id="quizNextBtn">
                    Next
                    <iconify-icon icon="ph:arrow-right-bold"></iconify-icon>
                </button>
            </div>
        </div>
    </div>

    <div id="pageContent" style="display: none;">
        <div class="bg-pattern"></div>
        
        <div class="container">
            <header class="header">
                <a href="/" class="back-btn">
                    <iconify-icon icon="ph:arrow-left-bold"></iconify-icon>
                </a>
                <h1 class="page-title">Training Centre</h1>
            </header>

            <!-- Progress Section -->
            <div class="progress-section">
                <div class="progress-header">
                    <span class="progress-title">
                        <iconify-icon icon="ph:chart-line-up-bold"></iconify-icon>
                        Your Progress
                    </span>
                    <span class="progress-stats" id="progressStats">0 of 0 completed</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-note" id="progressNote">
                    <iconify-icon icon="ph:info-bold"></iconify-icon>
                    <span id="progressNoteText">Progress is saved on this device.</span>
                </div>
            </div>

            <!-- Category Tabs -->
            <div class="role-tabs">
                <button class="role-tab active" data-role="website">
                    <iconify-icon icon="ph:globe-bold"></iconify-icon>
                    Website
                </button>
                <button class="role-tab" data-role="software">
                    <iconify-icon icon="ph:code-bold"></iconify-icon>
                    Software
                </button>
                <button class="role-tab" data-role="hardware">
                    <iconify-icon icon="ph:cpu-bold"></iconify-icon>
                    Hardware
                </button>
            </div>

            <!-- Website Training Content -->
            <div class="training-content active" data-role="website">
                
                <!-- Module 1: Dashboard Overview -->
                <div class="module-card" data-module="web-1">
                    <div class="module-header" onclick="toggleModule(this)">
                        <div class="module-icon video">
                            <iconify-icon icon="ph:play-bold"></iconify-icon>
                        </div>
                        <div class="module-info">
                            <h3 class="module-title">Dashboard Overview</h3>
                            <div class="module-meta">
                                <span><iconify-icon icon="ph:clock-bold"></iconify-icon> 3 min</span>
                                <span><iconify-icon icon="ph:video-bold"></iconify-icon> Video</span>
                            </div>
                        </div>
                        <div class="module-status">
                            <span class="status-badge not-started">Not Started</span>
                            <iconify-icon icon="ph:caret-down-bold" class="expand-icon"></iconify-icon>
                        </div>
                    </div>
                    <div class="module-content">
                        <div class="content-body">
                            <div class="video-container" id="dashboard-video-container">
                                <!-- Video will be loaded here via JavaScript -->
                            </div>
                            <div class="content-text">
                                <p>This video provides a comprehensive overview of the SwingCity Dashboard and its key features for staff members.</p>
                                <p><strong>What you'll learn:</strong></p>
                                <ul>
                                    <li>Navigating the main dashboard interface</li>
                                    <li>Understanding the different sections and their purposes</li>
                                    <li>Accessing key features like Teams, Leaderboard, and High Scores</li>
                                    <li>Basic navigation and getting started with the system</li>
                                </ul>
                                <p><strong>Dashboard Sections:</strong></p>
                                <ul>
                                    <li><strong>Teams:</strong> Create and manage player teams</li>
                                    <li><strong>Leaderboard:</strong> Live scores and rankings display</li>
                                    <li><strong>High Scores:</strong> All-time best performances</li>
                                    <li><strong>Podium:</strong> Winner celebration display</li>
                                    <li><strong>App Install:</strong> Download tablet app updates</li>
                                    <li><strong>Training:</strong> This training centre</li>
                                </ul>
                            </div>
                            <button class="complete-btn" onclick="toggleComplete(this, 'web-1')">
                                <iconify-icon icon="ph:check-circle-bold"></iconify-icon>
                                Mark as Complete
                            </button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Software Training Content -->
            <div class="training-content" data-role="software">
                
                <!-- Module 1: Hosting a Booking -->
                <div class="module-card" data-module="soft-1">
                    <div class="module-header" onclick="toggleModule(this)">
                        <div class="module-icon video">
                            <iconify-icon icon="ph:play-bold"></iconify-icon>
                        </div>
                        <div class="module-info">
                            <h3 class="module-title">Hosting a Booking</h3>
                            <div class="module-meta">
                                <span><iconify-icon icon="ph:clock-bold"></iconify-icon> 2 min</span>
                                <span><iconify-icon icon="ph:video-bold"></iconify-icon> Video</span>
                            </div>
                        </div>
                        <div class="module-status">
                            <span class="status-badge not-started">Not Started</span>
                            <iconify-icon icon="ph:caret-down-bold" class="expand-icon"></iconify-icon>
                        </div>
                    </div>
                    <div class="module-content">
                        <div class="content-body">
                            <div class="video-container" id="soft-1-video-container">
                                <!-- Video will be loaded here via JavaScript -->
                            </div>
                            <div class="content-text">
                                <p>This video demonstrates how to host a booking and show customers how the SwingCity system works.</p>
                                <p><strong>What you'll learn:</strong></p>
                                <ul>
                                    <li>How to guide customers through the booking process</li>
                                    <li>Demonstrating the system features to new players</li>
                                    <li>Key points to explain during a booking</li>
                                    <li>Best practices for hosting and customer interaction</li>
                                </ul>
                                <p><strong>Hosting Tips:</strong></p>
                                <ul>
                                    <li>Be friendly and welcoming to create a positive experience</li>
                                    <li>Explain the system clearly and answer any questions</li>
                                    <li>Show customers how to use RFID cards and navigate the course</li>
                                    <li>Ensure they understand the scoring system and how to view their progress</li>
                                </ul>
                            </div>
                            <button class="complete-btn" onclick="toggleComplete(this, 'soft-1')">
                                <iconify-icon icon="ph:check-circle-bold"></iconify-icon>
                                Mark as Complete
                            </button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Hardware Training Content -->
            <div class="training-content" data-role="hardware">
                
                <!-- Module 1: Sensor Location and Replacement -->
                <div class="module-card" data-module="hard-1">
                    <div class="module-header" onclick="toggleModule(this)">
                        <div class="module-icon video">
                            <iconify-icon icon="ph:play-bold"></iconify-icon>
                        </div>
                        <div class="module-info">
                            <h3 class="module-title">Sensor Location</h3>
                            <div class="module-meta">
                                <span><iconify-icon icon="ph:clock-bold"></iconify-icon> 4 min</span>
                                <span><iconify-icon icon="ph:video-bold"></iconify-icon> Video</span>
                            </div>
                        </div>
                        <div class="module-status">
                            <span class="status-badge not-started">Not Started</span>
                            <iconify-icon icon="ph:caret-down-bold" class="expand-icon"></iconify-icon>
                        </div>
                    </div>
                    <div class="module-content">
                        <div class="content-body">
                            <div class="video-container" id="hard-1-video-container">
                                <!-- Video will be loaded here via JavaScript -->
                            </div>
                            <div class="content-text">
                                <p>This video provides a comprehensive guide on locating sensors throughout the SwingCity course and how to replace them when needed.</p>
                                <p><strong>What you'll learn:</strong></p>
                                <ul>
                                    <li>How to identify sensor locations on each hole</li>

                                    <li>Tools and equipment needed for sensor maintenance</li>
                                
                                </ul>
                                <p><strong>Key Points:</strong></p>
                                <ul>
                                
                                    <li> How to quickly locate sensors on each hole</li>
                                
                                </ul>
                                <p><strong>Important Notes:</strong></p>
                                <ul>
                                    <li>Document sensor locations for future reference</li>
                                    <li>Test sensors thoroughly after replacement</li>
                                    <li>Keep spare sensors on hand for quick replacements</li>
                                </ul>
                            </div>
                            <button class="complete-btn" onclick="toggleComplete(this, 'hard-1')">
                                <iconify-icon icon="ph:check-circle-bold"></iconify-icon>
                                Mark as Complete
                            </button>
                        </div>
                    </div>
                </div>

            </div>

            <footer class="footer">
                SwingCity Â© <%= new Date().getFullYear() %>
            </footer>
        </div>
    </div>

    <script src="/js/pin-lock.js"></script>
    <script>
        // ==================== TRAINING MODULE SYSTEM ====================
        
        // Get current user info
        function getCurrentUser() {
            const userStr = sessionStorage.getItem('swingcity_user');
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    return user;
                } catch (e) {
                    console.error('Error parsing user info:', e);
                }
            }
            // Default staff member if no user info - try to get from authenticated session
            const authenticated = sessionStorage.getItem('swingcity_authenticated');
            if (authenticated === 'true') {
                // User is authenticated but no user object - likely default PIN
                // We'll use a default key
                return { id: null, name: 'Staff', pin: 'default' };
            }
            return { id: null, name: 'Staff', pin: 'default' };
        }

        // Get storage key for current user - always use PIN as primary identifier
        function getStorageKey() {
            const user = getCurrentUser();
            // Prioritize PIN over ID since PIN is always present
            // For default PIN users, use 'default' as the identifier
            let userId = 'default';
            
            if (user) {
                if (user.pin && user.pin !== 'default') {
                    // Use PIN as the identifier (most reliable)
                    userId = `pin_${user.pin}`;
                } else if (user.id) {
                    // Fallback to ID if PIN not available
                    userId = `id_${user.id}`;
                } else if (user.pin === 'default') {
                    // Default PIN user
                    userId = 'default';
                }
            }
            
            const storageKey = `swingcity_training_completed_${userId}`;
            return storageKey;
        }

        // State management - per user
        let completedModules = JSON.parse(localStorage.getItem(getStorageKey()) || '{}');
        let currentCategory = 'website';

        // Check if user is default staff account
        function isDefaultStaff() {
            const user = getCurrentUser();
            return user && user.pin === 'default';
        }

        // Load training progress from Firebase
        async function loadTrainingProgress() {
            const user = getCurrentUser();
            const userPin = user?.pin || 'default';
            
            try {
                const response = await fetch(`/api/training/progress?pin=${userPin}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.progress) {
                        // Merge Firebase data with localStorage (Firebase takes priority)
                        const storageKey = getStorageKey();
                        const localData = JSON.parse(localStorage.getItem(storageKey) || '{}');
                        completedModules = { ...localData, ...data.progress };
                        // Update localStorage with merged data
                        localStorage.setItem(storageKey, JSON.stringify(completedModules));
                    }
                }
            } catch (error) {
                console.error('Error loading training progress from Firebase:', error);
                // Fall back to localStorage only
                const storageKey = getStorageKey();
                completedModules = JSON.parse(localStorage.getItem(storageKey) || '{}');
            }
        }

        // Initialize on page load
        async function initTraining() {
            // Load progress from Firebase first
            await loadTrainingProgress();
            
            // Hide progress bar for default staff account
            const progressSection = document.querySelector('.progress-section');
            if (isDefaultStaff() && progressSection) {
                progressSection.style.display = 'none';
            } else if (progressSection) {
                progressSection.style.display = 'block';
            }
            
            updateUserInfo();
            updateAllStatuses();
            updateProgress();
        }

        // Update user info display
        function updateUserInfo() {
            const user = getCurrentUser();
            const noteText = document.getElementById('progressNoteText');
            if (noteText) {
                noteText.textContent = `Progress tracked for: ${user.name || 'Staff'}. Progress is saved per staff member.`;
            }
        }

        // Tab switching
        document.querySelectorAll('.role-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Update active tab
                document.querySelectorAll('.role-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Update active content
                currentCategory = tab.dataset.role;
                document.querySelectorAll('.training-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.querySelector(`.training-content[data-role="${currentCategory}"]`).classList.add('active');
                
                // Progress is now global, so no need to update on tab switch
            });
        });

        // Toggle module expansion
        function toggleModule(header) {
            const card = header.closest('.module-card');
            const isExpanding = !card.classList.contains('expanded');
            card.classList.toggle('expanded');
            
            // Load video when module is expanded
            if (isExpanding) {
                const moduleId = card.getAttribute('data-module');
                const videoContainer = card.querySelector('.video-container');
                if (videoContainer && moduleId) {
                    const containerId = videoContainer.getAttribute('id');
                    if (containerId) {
                        loadVideo(moduleId, containerId);
                    }
                }
            }
        }

        // Toggle completion status
        function toggleComplete(btn, moduleId) {
            // Reload modules from storage in case user changed
            completedModules = JSON.parse(localStorage.getItem(getStorageKey()) || '{}');
            
            const isCompleted = completedModules[moduleId];
            
            if (isCompleted) {
                // Uncomplete module
                delete completedModules[moduleId];
                btn.classList.remove('completed');
                btn.innerHTML = '<iconify-icon icon="ph:check-circle-bold"></iconify-icon> Mark as Complete';
                
                // Save to localStorage with user-specific key
                localStorage.setItem(getStorageKey(), JSON.stringify(completedModules));
                
                // Update status badge
                updateModuleStatus(moduleId);
                
                // Update progress
                updateProgress();
            } else {
                // Show quiz before marking as complete
                showQuiz(moduleId);
            }
        }

        // Update status badge for a module
        function updateModuleStatus(moduleId) {
            // Ensure we have the latest data
            const latestModules = JSON.parse(localStorage.getItem(getStorageKey()) || '{}');
            const card = document.querySelector(`[data-module="${moduleId}"]`);
            if (!card) return;
            
            const badge = card.querySelector('.status-badge');
            if (badge) {
                if (latestModules[moduleId]) {
                    badge.className = 'status-badge completed';
                    badge.textContent = 'Completed';
                } else {
                    badge.className = 'status-badge not-started';
                    badge.textContent = 'Not Started';
                }
            }
        }

        // Update all module statuses
        function updateAllStatuses() {
            // Reload modules from storage in case user changed
            completedModules = JSON.parse(localStorage.getItem(getStorageKey()) || '{}');
            
            Object.keys(completedModules).forEach(moduleId => {
                updateModuleStatus(moduleId);
                
                // Update button state
                const card = document.querySelector(`[data-module="${moduleId}"]`);
                if (card) {
                    const btn = card.querySelector('.complete-btn');
                    if (btn && completedModules[moduleId]) {
                        btn.classList.add('completed');
                        btn.innerHTML = '<iconify-icon icon="ph:check-circle-fill"></iconify-icon> Completed!';
                    }
                }
            });
        }

        // Update progress bar - shows overall progress across all categories
        function updateProgress() {
            // Don't update progress for default staff account
            if (isDefaultStaff()) {
                return;
            }
            
            // Reload modules from storage in case user changed
            completedModules = JSON.parse(localStorage.getItem(getStorageKey()) || '{}');
            
            // Count all modules across all categories
            let totalModules = 0;
            let completedCount = 0;
            
            document.querySelectorAll('.training-content').forEach(content => {
                content.querySelectorAll('.module-card').forEach(card => {
                    const moduleId = card.dataset.module;
                    totalModules++;
                    if (completedModules[moduleId]) {
                        completedCount++;
                    }
                });
            });
            
            // Update UI
            const percentage = totalModules > 0 ? (completedCount / totalModules) * 100 : 0;
            const progressFill = document.getElementById('progressFill');
            const progressStats = document.getElementById('progressStats');
            if (progressFill) progressFill.style.width = `${percentage}%`;
            if (progressStats) progressStats.textContent = `${completedCount} of ${totalModules} completed`;
        }

        // ==================== VIDEO LOADING SYSTEM ====================
        
        // Video configuration - Update these URLs with your actual video sources
        const videoConfig = {
            'web-1': {
                // Dashboard Overview video - YouTube unlisted
                type: 'youtube',
                url: 'QKmFzc5dgVk'
            },
            'soft-1': {
                // Hosting a Booking video - YouTube unlisted
                type: 'youtube',
                url: '_PMBBdwD6BU'
            },
            'hard-1': {
                // Sensor Location Video 01 - YouTube
                type: 'youtube',
                url: 'JXdsVZlco3w'
            }
            // Add more video configs for other modules as needed
        };

        // ==================== QUIZ SYSTEM ====================
        
        // Quiz questions for each module
        const quizData = {
            'web-1': {
                questions: [
                    {
                        question: 'What is the main purpose of the SwingCity Dashboard?',
                        options: [
                            'To play games',
                            'To manage the venue and teams',
                            'To watch videos',
                            'To check emails'
                        ],
                        correct: 1
                    },
                    {
                        question: 'Which section allows you to create and manage player teams?',
                        options: [
                            'Leaderboard',
                            'High Scores',
                            'Teams',
                            'Training'
                        ],
                        correct: 2
                    },
                    {
                        question: 'What does the Leaderboard display?',
                        options: [
                            'All-time best scores',
                            'Both live scores for active teams and all-time best scores',
                            'Team managment',
                            'App downloads'
                        ],
                        correct: 1
                    }
                ]
            },
            'soft-1': {
                questions: [
                    {
                        question: 'What is the main purpose of hosting a booking?',
                        options: [
                            'To play the game yourself',
                            'To demonstrate the system and guide customers',
                            'To fix technical issues',
                            'To update the software'
                        ],
                        correct: 1
                    },
                    {
                        question: 'What should you explain to customers during a booking?',
                        options: [
                            'Only the scoring system',
                            'How to use RFID cards, navigate the holes, and view progress',
                            'The rules of crazy golf',
                            'Nothing - let them figure it out'
                        ],
                        correct: 1
                    },
                    {
                        question: 'What is important when hosting a booking?',
                        options: [
                            'Be quiet and let customers explore alone',
                            'Be friendly, explain clearly, and answer questions',
                            'Rush through the explanation quickly',
                            'Show how the sensors work'
                        ],
                        correct: 1
                    }
                ]
            },
            'hard-1': {
                questions: [
                    {
                        question: 'Where can you find the 100 sensor for Plinko?',
                        options: [
                            'Just unscrew the cover of the hole',
                            'Take off every shurikan and throw them at the sensor',
                            'Open the hatch next to the front door',
                            'Underneath the tablet'
                        ],
                        correct: 2
                    },
                    {
                        question: 'What should you do before replacing a sensor?',
                        options: [
                            'Test the sensor first',
                            'Power down the system',
                            'Call technical support',
                            'Nothing - just replace it'
                        ],
                        correct: 0
                    },
                    {
                        question: 'Where can you find the sensors for Octagon?',
                        options: [
                            'Jump down the behind the hole',
                            'To quickly locate and replace faulty sensors when needed',
                            'By putting a ball through the pipe and looking through the other end',
                            'By sliding out and then lifting the inner octagon'
                        ],
                        correct: 3
                    },
                    {
                        question: 'What should you do after replacing a sensor?',
                        options: [
                            'Leave it and hope it works',
                            'Test the sensor to verify it is working correctly',
                            'Replace all other sensors too',
                            'Restart the entire system'
                        ],
                        correct: 1
                    }
                ]
            }
            // Add more quiz data for other modules as needed
        };

        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let quizAnswers = [];

        // Show quiz for a module
        function showQuiz(moduleId) {
            const quiz = quizData[moduleId];
            if (!quiz || !quiz.questions || quiz.questions.length === 0) {
                // No quiz for this module, mark as complete directly
                markModuleComplete(moduleId);
                return;
            }

            currentQuiz = {
                moduleId: moduleId,
                questions: quiz.questions
            };
            currentQuestionIndex = 0;
            quizAnswers = [];

            renderQuiz();
            setupQuizNextButton();
            document.getElementById('quizOverlay').classList.add('active');
        }

        // Render current quiz question
        function renderQuiz() {
            if (!currentQuiz) {
                console.error('currentQuiz is null in renderQuiz');
                return;
            }
            
            const content = document.getElementById('quizContent');
            const question = currentQuiz.questions[currentQuestionIndex];
            
            // Clear previous content
            content.innerHTML = '';

            // Update progress
            const progress = ((currentQuestionIndex + 1) / currentQuiz.questions.length) * 100;
            document.getElementById('quizProgressFill').style.width = `${progress}%`;
            document.getElementById('quizProgressText').textContent = `${currentQuestionIndex + 1} of ${currentQuiz.questions.length}`;

            // Create question HTML
            const questionDiv = document.createElement('div');
            questionDiv.className = 'quiz-question active';
            questionDiv.innerHTML = `
                <div class="question-number">Question ${currentQuestionIndex + 1}</div>
                <div class="question-text">${question.question}</div>
                <div class="quiz-options">
                    ${question.options.map((option, index) => `
                        <button class="quiz-option" data-index="${index}" onclick="selectQuizOption(this, ${index})">
                            ${option}
                        </button>
                    `).join('')}
                </div>
            `;

            content.appendChild(questionDiv);

            // Update button state
            const nextBtn = document.getElementById('quizNextBtn');
            nextBtn.disabled = true;
            if (currentQuestionIndex === currentQuiz.questions.length - 1) {
                nextBtn.innerHTML = '<iconify-icon icon="ph:check-circle-bold"></iconify-icon> Complete';
            } else {
                nextBtn.innerHTML = 'Next <iconify-icon icon="ph:arrow-right-bold"></iconify-icon>';
            }
        }

        // Select quiz option
        window.selectQuizOption = function(button, index) {
            // Remove previous selection
            button.parentElement.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Mark as selected
            button.classList.add('selected');
            quizAnswers[currentQuestionIndex] = index;

            // Enable next button
            document.getElementById('quizNextBtn').disabled = false;
        };

        // Handle quiz next/complete
        let quizNextHandler = null;
        
        function setupQuizNextButton() {
            const nextBtn = document.getElementById('quizNextBtn');
            // Remove old handler if exists
            if (quizNextHandler) {
                nextBtn.removeEventListener('click', quizNextHandler);
            }
            
            // Create new handler
            quizNextHandler = () => {
                if (!currentQuiz) {
                    console.error('currentQuiz is null');
                    return;
                }
                
                if (quizAnswers[currentQuestionIndex] === undefined) {
                    return; // No answer selected
                }

                if (currentQuestionIndex < currentQuiz.questions.length - 1) {
                    // Move to next question
                    currentQuestionIndex++;
                    renderQuiz();
                    setupQuizNextButton(); // Re-setup for next question
                } else {
                    // All questions answered, show results
                    showQuizResults();
                }
            };
            
            nextBtn.addEventListener('click', quizNextHandler);
        }

        // Show quiz results
        function showQuizResults() {
            if (!currentQuiz) {
                console.error('currentQuiz is null in showQuizResults');
                closeQuiz();
                return;
            }
            
            let correctCount = 0;
            currentQuiz.questions.forEach((question, index) => {
                if (quizAnswers[index] === question.correct) {
                    correctCount++;
                }
            });

            const content = document.getElementById('quizContent');
            const passed = correctCount === currentQuiz.questions.length;
            const moduleId = currentQuiz.moduleId; // Store moduleId before it might be cleared

            content.innerHTML = `
                <div class="quiz-result">
                    <div class="quiz-result-icon ${passed ? 'success' : 'failed'}">
                        <iconify-icon icon="ph:${passed ? 'check-circle-fill' : 'x-circle-fill'}"></iconify-icon>
                    </div>
                    <h3 class="quiz-result-title">${passed ? 'Great job!' : 'Almost there!'}</h3>
                    <p class="quiz-result-score">You got ${correctCount} out of ${currentQuiz.questions.length} questions correct</p>
                    ${!passed ? '<p style="color: var(--text-secondary); margin-top: 1rem;">Please review the video and try again.</p>' : ''}
                </div>
            `;

            const nextBtn = document.getElementById('quizNextBtn');
            
            // Remove old handler
            if (quizNextHandler) {
                nextBtn.removeEventListener('click', quizNextHandler);
            }
            
            if (passed) {
                nextBtn.innerHTML = '<iconify-icon icon="ph:check-circle-bold"></iconify-icon> Mark as Complete';
                // Create new handler for completion - use stored moduleId
                quizNextHandler = () => {
                    closeQuiz();
                    markModuleComplete(moduleId);
                };
            } else {
                nextBtn.innerHTML = '<iconify-icon icon="ph:arrow-clockwise-bold"></iconify-icon> Try Again';
                // Create new handler for retry
                quizNextHandler = () => {
                    // Reset and restart quiz
                    currentQuestionIndex = 0;
                    quizAnswers = [];
                    renderQuiz();
                    setupQuizNextButton();
                };
            }
            nextBtn.addEventListener('click', quizNextHandler);
            nextBtn.disabled = false;
        }

        // Close quiz
        function closeQuiz() {
            document.getElementById('quizOverlay').classList.remove('active');
            currentQuiz = null;
            currentQuestionIndex = 0;
            quizAnswers = [];
        }

        // Cancel quiz
        document.getElementById('quizCancelBtn').addEventListener('click', closeQuiz);

        // Close on overlay click
        document.getElementById('quizOverlay').addEventListener('click', (e) => {
            if (e.target.id === 'quizOverlay') {
                closeQuiz();
            }
        });

        // Mark module as complete (after quiz passed)
        async function markModuleComplete(moduleId) {
            // Get the storage key for current user
            const storageKey = getStorageKey();
            const user = getCurrentUser();
            const userPin = user?.pin || 'default';
            
            // Reload modules from storage in case user changed
            completedModules = JSON.parse(localStorage.getItem(storageKey) || '{}');
            
            // Mark as completed
            completedModules[moduleId] = true;
            
            // Save to localStorage with user-specific key (for offline/cache)
            localStorage.setItem(storageKey, JSON.stringify(completedModules));
            
            // Save to Firebase (primary storage)
            try {
                const response = await fetch('/api/training/progress', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        pin: userPin,
                        completedModules: completedModules
                    })
                });
                
                if (!response.ok) {
                    console.warn('Failed to save training progress to Firebase, using localStorage only');
                }
            } catch (error) {
                console.error('Error saving training progress to Firebase:', error);
                // Continue with localStorage only if Firebase fails
            }
            
            // Find the module card
            const card = document.querySelector(`[data-module="${moduleId}"]`);
            if (!card) {
                return;
            }
            
            // Update button
            const btn = card.querySelector('.complete-btn');
            if (btn) {
                btn.classList.add('completed');
                btn.innerHTML = '<iconify-icon icon="ph:check-circle-fill"></iconify-icon> Completed!';
            }
            
            // Update status badge directly
            const badge = card.querySelector('.status-badge');
            if (badge) {
                badge.className = 'status-badge completed';
                badge.textContent = 'Completed';
            }
            
            // Update progress - use the helper function but ensure it uses updated data
            updateProgress();
            
            // Also call updateModuleStatus to ensure consistency
            updateModuleStatus(moduleId);
            
            // Show success notification
            setTimeout(() => {
                showCompletionNotification(moduleId);
            }, 100);
        }
        
        // Show completion notification
        function showCompletionNotification(moduleId) {
            const card = document.querySelector(`[data-module="${moduleId}"]`);
            if (!card) return;

            const moduleTitle = card.querySelector('.module-title')?.textContent || 'Module';
            
            // Create notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #00ff88, #00d4ff);
                color: #0a0a0f;
                padding: 1rem 1.5rem;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0, 255, 136, 0.3);
                z-index: 10001;
                font-weight: 600;
                animation: fadeInUp 0.3s ease;
            `;
            notification.innerHTML = `
                <iconify-icon icon="ph:check-circle-fill" style="font-size: 1.5rem; vertical-align: middle; margin-right: 0.5rem;"></iconify-icon>
                ${moduleTitle} completed!
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Load video based on type
        function loadVideo(moduleId, containerId) {
            const config = videoConfig[moduleId];
            if (!config) return;
            
            const container = document.getElementById(containerId);
            if (!container) return;
            
            let videoHTML = '';
            
            if (config.type === 'youtube') {
                // YouTube embed
                const videoId = config.url;
                videoHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?rel=0" allowfullscreen></iframe>`;
            } else if (config.type === 'vimeo') {
                // Vimeo embed
                const videoId = config.url;
                videoHTML = `<iframe src="https://player.vimeo.com/video/${videoId}" allowfullscreen></iframe>`;
            } else if (config.type === 'direct') {
                // Direct video URL
                videoHTML = `
                    <video controls preload="metadata">
                        <source src="${config.url}" type="video/mp4">
                        <source src="${config.url}" type="video/webm">
                        Your browser does not support the video tag.
                    </video>
                `;
            }
            
            if (videoHTML) {
                container.innerHTML = videoHTML;
            }
        }

        // Initialize when PIN is unlocked
        window.addEventListener('pinUnlocked', async () => {
            // Reload modules when user logs in
            await initTraining();
            // Load videos after initialization
            loadVideo('web-1', 'dashboard-video-container');
        });
        
        // Also check if already authenticated
        if (sessionStorage.getItem('swingcity_authenticated') === 'true') {
            initTraining().then(() => {
                // Load videos after initialization
                loadVideo('web-1', 'dashboard-video-container');
            });
        }

        // Reload when user changes (if they log out and back in)
        window.addEventListener('storage', (e) => {
            if (e.key && e.key.startsWith('swingcity_training_completed_')) {
                completedModules = JSON.parse(localStorage.getItem(getStorageKey()) || '{}');
                updateAllStatuses();
                updateProgress();
            }
        });
    </script>
</body>
</html>

